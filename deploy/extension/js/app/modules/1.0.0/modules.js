define("app/modules/1.0.0/modules",["gallery/jquery/1.0.0/jquery","common/utils/1.0.0/utils","gallery/json/1.0.0/json","common/event_types/1.0.0/event_types"],function(a){var b=a("gallery/jquery/1.0.0/jquery"),c=a("common/utils/1.0.0/utils"),d=c.debug,e=a("gallery/json/1.0.0/json"),f=a("common/event_types/1.0.0/event_types");f=f("data");var x,g=null,h=[],i=[],j=0,k=null,l=null,m=0,n=0,o=d?96:10,p=8,q=[],r=0,t="extlist",u=3e3,v=!1,w="vd",y="http://i.vod.xunlei.com/",z="http://dynamic.cloud.vip.xunlei.com/interface/get_unionurl_info",A={proxyId:"proxy_i",proxy:null},B={urlNotVideo:"该链接不含视频，添加时将被过滤",userInfoError:"用户帐号信息验证失败，建议重新登录",taskContainsError:"全部任务都有错误，无法添加",paramError:"请求参数有误，请检查后重新添加",timeout:"请求超时，请稍后重试",svrError:"服务器繁忙，请稍后重试"},C={init:function(a){this.initTaskProxy(),g=a,j=this.resources().length},addCtrls:function(a){q.push(a)},resources:function(a){var b=l||this.oriResources();return"undefined"!=typeof a?b[a]:b},oriResources:function(a){var b=k||g&&(k=this.analyseResources(g.resources))||[];return"undefined"!=typeof a?b[a]:b},sortDatas:function(a){l=a?"__reverse__"==a?this.resources().slice().reverse():this.resources().slice().sort(function(b,c){if("name"==a)return b[a]>c[a]?1:b[a]<c[a]?-1:0;if("filesize"==a){var b=parseInt(b[a])||0,c=parseInt(c[a])||0;return c-b}}):null,this.noticeController(f.DataSortedEvent)},analyseResources:function(a){for(var b,d,e="",f=this,g=[],j="vdadd",k={},l="",m=a.length,n=0;m>n;n++)if("string"==typeof a[n].url){b=a[n].url,j="vdadd",d=/^(magnet|thunder)/.test(b)?(h.push(n),1):(i.push(n),0),e=d?b.substring(0,b.indexOf("&")):c.getFileName(b),"undefined"==typeof k[e]?k[e]=b:k[e]++,e?!d&&(j=w+c.getFileExt(e)):e=b,l=e?c.toShortName(e,30,25,20):e;var o={name:e,ext:j,oindex:0,shortName:d?c.toShortName(e,30,25,20):l,id:"",url:b.replace(/\&amp;/g,"&"),gcid:"",inited:1,selected:0,isAdded:0,filesize:"--"};o.oindex=g.length,g.push(o)}return f.queryNames(g),f.getUrlsInfo(g),g},leftNum:function(){return j>m?j-m:0},setParam:function(a,b,c){this.oriResources(a)[b]=c},noticeController:function(a,b){for(var c in q)q[c]&&q[c].dispatchEvent(a,b)},displayListRange:function(a){switch(a){case C.AddMark:this.addPerDis();break;case C.SubMark:this.subPerDis();break;case C.EquMark:break;default:m=p}return this.resources().slice(n,m)},addPerDis:function(){m=j>=m+o?m+o:j},subPerDis:function(){m=m-o>0?m-o:0},add2VodList:function(a){var b=0,c=[],d=(a||[]).length;if(0!=d){for(b=0;d>b;b++){var e=this.oriResources(a[b]);c.push(e)}!v&&this.submitUrlTask(c)}},submitUrlTask:function(a){var d=this,f=a.length;if(0!=f){var g={urls:[]};x={};for(var h=0;f>h;++h){var i=a[h].name;i=b.trim(i),x[h]=a[h].oindex,g.urls.push({id:h,url:a[h].url,name:c.encode(i)})}g=e.stringify(g),c.log(g),d.doAddTask(g,d.doAddTaskDone,d.doAddTaskError)}},doAddTask:function(a,b,d){if(void 0==a||void 0==b)return-1;var e=0,f=this,g=c.getCookie("userid"),h=c.getCookie("sessionid"),i=y+"req_add_record?from="+t+"&platform="+e+"&userid="+g+"&sessionid="+h;v=!0,f.vodPost(i,a,b,d)},vodPost:function(a,b,c,d,e){var f=arguments,g=f.callee,h=this;return"undefined"==typeof A.proxy.$?(setTimeout(function(){g.call(h,a,b,c,d,e+1)},200),void 0):(A.proxy.$.ajax({type:"POST",dataType:"json",url:a,data:b,timeout:u,error:function(){d()},success:function(a){c(a)}}),void 0)},doAddTaskError:function(){v=!1,C.noticeController(f.AddListStateChangeEvent,{param:"error",urls:[]})},doAddTaskDone:function(a){if(v=!1,a.resp)try{var d=a.resp.ret,e="";if(0==d){for(var k,l,g=a.resp.res,h=g.length,i=0,j=[],m=0;h>m;m++)0==g[m].result?("undefined"!=typeof x[g[m].id]&&(k=x[g[m].id],l=C.oriResources(k),l.isAdded=!0,j.push({index:k,item:l})),i++):e=8==g[m].result?B.urlNotVideo:6==g[m].result||2==g[m].result?B.paramError:B.svrError;return i>0?C.noticeController(f.AddListStateChangeEvent,{param:"added",urls:j}):C.noticeController(f.AddListStateChangeEvent,{param:"error",urls:j}),void 0}e=1==d?B.userInfoError:3==d?B.timeout:B.svrError,C.noticeController(f.AddListStateChangeEvent,{param:"error",urls:[]}),c.log(e)}catch(n){C.noticeController(f.AddListStateChangeEvent,{param:"error",urls:[]})}else e=B.svrError,c.log(e),C.noticeController(f.AddListStateChangeEvent,{param:"error",urls:[]})},thunderDown:function(a){function k(b){var c=navigator.mimeTypes["application/np_xunlei_plugin.2"];if(c){var d=document.createElement("embed");d.style.visibility="hidden",d.type="application/np_xunlei_plugin.2",d.width=0,d.height=0,document.body.appendChild(d);var e="#@$@#",f="";f=f.concat(e),f=f.concat(b.length,e);for(var g=0;b.length>g;g++)f=f.concat(b[g].url,e),f=f.concat(b[g].name,e),f=f.concat("",e),f=f.concat("null",e),f=f.concat("",e),f=f.concat("",e);d.DownLoadListByThunderPlugin(f)}else{var h=b[0].url,i=navigator.mimeTypes["application/np_xunlei_plugin"];if(!i)return alert("您尚未安装迅雷下载软件，请下载安装最新版后重试。"),a.failsCall(a.failsParam),void 0;var d=document.createElement("embed");d.style.visibility="hidden",d.type="application/np_xunlei_plugin",d.width=0,d.height=0,document.body.appendChild(d),d.DownLoadByThunderPlugin(h)}}var d=a.resources.length;if(c.isUA("ie"))try{var e=c.getCurrentThunder();if(console.log(0),1>d)return console.log(1),!1;if(1==d&&e.download){console.log(2);var f=a.resources[0].cid,g=a.resources[0].url,h=a.resources[0].refer,i=a.resources[0].name;e.download(f,g,h,i)}else{if(!(d>1&&e.batchDownload))return alert("您尚未安装迅雷下载软件，请下载安装最新版后重试。"),a.failsCall(a.failsParam),void 0;console.log(3),e.batchDownload(a.resources,a.resources[0].refer)}}catch(j){return console.log(j),alert("您尚未安装迅雷下载软件，请下载安装最新版后重试。"),a.failsCall(a.failsParam),void 0}else k(a.resources)},openAndPlay:function(a,b){var d=c.getCookie("userid")+"_"+"4"+"_"+c.getCookie("sessionid");a=encodeURIComponent(a);var e=["http://vod.xunlei.com","/iplay.html?","uvs=",d,"&url=",a,"&tryplay="+(1-b),"&from=",t];e=e.join(""),window.open(e,"_blank")},initTaskProxy:function(){document.domain="xunlei.com",A.proxy=document.getElementById(A.proxyId).contentWindow},getUrlsInfo:function(a){if(a[i[r]]){var c=a[i[r]].url;b.getScript(z+"?url="+encodeURIComponent(c)+"&callback=queryunionurl")}},queryNames:function(a){for(var b=this,c=[],d=h.length,f=0,g=0;d>g;g++){f=h[g];var i=a[f].name||a[f].url;c.push({id:f,url:encodeURIComponent(i)})}if(c.length>0){var j=y+"req_video_name?from=vlist&platform=0",k=c.length,l=0,m=50,n=k>m?m:k,o=function(a){b.queryNamesDone(a),k>n&&(l=n,n=k>n+m?n+m:k,setTimeout(function(){b.vodPost(j,e.stringify({urls:c.slice(l,n)}),o,function(){})},500))};setTimeout(function(){b.vodPost(j,e.stringify({urls:c.slice(l,n)}),o,function(){})},100)}},queryNamesDone:function(a){var b=this,a=a.resp;if(a){var d=a.ret,e=a.res,g=[];if(0==d){if(e.length>0)for(var h=e.length,i=0;h>i;i++){var j=e[i],k=j.id,l=["mkv","xv","rm","mp4","3gp","wmv","asf","vob","mov","m4v","flv","ts","bt","avi","rmvb","mpg","mpeg","f4v","MKV","XV","RM","MP4","3GP","WMV","ASF","VOB","MOV","M4V","FLV","TS","BT","AVI","RMVB","MPG","MPEG","F4V$"].join("$|"),m=new RegExp("\\.("+l+")\\b"),n="",o=b.oriResources(k);0==j.result?(o.name=c.decode(j.name),o.inited=1,o.shortName=c.toShortName(o.name,30,25,20),(n=m.exec(j.name))&&(o.ext="vd"+n[1].toLocaleLowerCase())):o.inited=0,g.push(k)}C.noticeController(f.FetchedFileSizeEvent,{indexs:g})}}}};return window.queryunionurl=function(a,d,e,g,h,j){var l=i[r];a&&"0"!=a&&(k[l].gcid=a),d&&"0"!=d&&(k[l].filesize=d),e&&"0"!=e&&(k[l].shortName=c.decode(e).replace(/<.*?>/g,"")),g&&"0"!=g&&(k[l].name=c.decode(g)),h&&"0"!=h&&(k[l].ext=w+h),C.noticeController(f.FetchedFileSizeEvent,{indexs:[l]}),r++,i.length>r&&(url=k[i[r]].url,setTimeout(function(){b.getScript(z+"?url="+encodeURIComponent(url)+"&callback=queryunionurl")},200))},b.extend(C,{noNeed2Response:0,AddMark:"+",SubMark:"-",EquMark:"="}),C});