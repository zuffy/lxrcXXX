define("common/login/1.0.0/login",["gallery/jquery/1.0.0/jquery","common/utils/1.0.0/utils"],function(a){function w(a){return null==document.cookie.match(new RegExp("(^"+a+"| "+a+")=([^;]*)"))?"":decodeURIComponent(RegExp.$2)}function x(a,b,c){if(arguments.length>2){var e=new Date((new Date).getTime()+36e5*c);document.cookie=a+"="+encodeURIComponent(b)+"; path=/; domain="+k.domain+"; expires="+e.toGMTString()}else document.cookie=a+"="+encodeURIComponent(b)+"; path=/; domain="+k.domain}function z(a){for(var b=[],c=0;a.length>c;c++)b.push(a[c]);return b}function C(a,b,c){if(arguments.length>2){var d=new Date((new Date).getTime()+1e3*c);document.cookie=a+"="+escape(b)+"; path=/; domain=vod.xunlei.com; expires="+d.toGMTString()}else document.cookie=a+"="+escape(b)+"; path=/; domain=vod.xunlei.com"}function F(a,b,c){if("function"==typeof c)a.addEventListener(b,c);else{var d=z(arguments);d.shift(),setTimeout(function(){a.fireEvent.apply(a,d)},10)}}function H(a){if(!G){var c="http://login.xunlei.com/check?u="+a+"&t="+new Date;G=!0;var d="union_poster_iframe_"+(new Date).getTime()+"_"+parseInt(1e5*Math.random());$.browser.msie&&"6.0"==b.browser.version?$("body").append("<iframe id='"+d+"' name='"+d+"' width='0' height='0'></iframe>"):$("body").append("<iframe id='"+d+"' name='"+d+"' src='"+q+"' width='0' height='0'></iframe>");var e=$("#"+d);e.load(function(){$(this).unbind("load").load(function(){var a=parseInt(w("check_result"));if(0==a){$("#"+k.verifyp).hide();var b=w("check_result").split(":")[1];$("#"+k.verifycode).val(b)}else $("#"+k.verifycode).val(""),D.vcode(),$("#"+k.verifyp).show();G=!1,$(e).remove()}),this.src=c,setTimeout(function(){G=!1},300)}),e.hide()}}function I(){return $("#"+k.u).val($("#"+k.u).val().trim()),$("#"+k.p).val($("#"+k.p).val().trim()),0==$("#"+k.u).val().length?(D.valid("请输入帐号"),$("#"+k.u).focus(),!1):0==$("#"+k.p).val().length?(D.valid("请输入密码"),$("#"+k.p).focus(),!1):0==$("#"+k.verifycode).val().length?(D.valid("请输入验证码"),$("#"+k.verifycode).focus(),!1):!0}function J(){if(!j){j=1,d.unbind("load"),e=$("<form />").attr({method:"post",target:d.attr("name"),action:o[r]+"sec2login/"});var a={};a.u=encodeURI($("#"+k.u).val()),$("#"+k.auto).attr("checked")?(a.login_enable=1,a.login_hour=k.expire):(a.login_enable=0,a.login_hour=0);var b=N($("#"+k.p).val());b=N(b),b=N(b+$("#"+k.verifycode).val().toUpperCase()),a.p=encodeURIComponent(b),a.verifycode=encodeURIComponent($("#"+k.verifycode).val().toUpperCase());for(var c in a)$("<input>",{type:"hidden",val:a[c],name:c}).appendTo(e);$("body").append(e),e.hide(),d.load(K),D.logining(),s=setTimeout(function(){K()},7e3),e.submit()}}function K(){j=0,s&&clearTimeout(s);var a=w("blogresult"),b={1:"验证码错误",2:"密码错误",3:"服务器忙",4:"帐号不存在",5:"数据包错误",6:"帐号被锁定",7:"session请求失败",8:"服务器忙",9:"验证码长度不对",10:"非法验证码",11:"验证码超时",12:"登录页面无效",13:"登录页面无效",14:"登录页面无效",15:"登录页面无效",16:"网络超时，请重新登录"};if(d=null,e=null,"0"!=a)if(r++,o.length>r&&(""==a||3==a||7==a))D.run();else{$("#"+k.submit).attr("disabled",!1),D.vOneCode(),(2==a||1==a||9==a)&&$("#"+k.p).val("").focus(),r=0;var c=b[a];if("undefined"==typeof b[a])var c="未知错误";D.error(a,c)}else r=0,D.success(3)}function L(){d.unbind("load"),e=$("<form />",{method:"post",target:d.attr("name"),action:o[r]+"sessionid/"}),$("<input>",{type:"hidden",name:"sessionid",val:n}).appendTo(e),$("body").append(e),e.hide(),d.load(M),D.logining(),s=setTimeout(function(){M()},7e3),e.submit()}function M(){s&&clearTimeout(s);var a=w("blogresult");d=null,e=null,"0"!=a?(r++,o.length>r&&(""==a||3==a||7==a)?D.auto(n):(r=0,D.autoerror())):(r=0,D.success())}function N(a){return eb(U(cb(a),a.length*v))}function U(a,b){a[b>>5]|=128<<b%32,a[(b+64>>>9<<4)+14]=b;for(var c=1732584193,d=-271733879,e=-1732584194,f=271733878,g=0;a.length>g;g+=16){var h=c,i=d,j=e,k=f;c=W(c,d,e,f,a[g+0],7,-680876936),f=W(f,c,d,e,a[g+1],12,-389564586),e=W(e,f,c,d,a[g+2],17,606105819),d=W(d,e,f,c,a[g+3],22,-1044525330),c=W(c,d,e,f,a[g+4],7,-176418897),f=W(f,c,d,e,a[g+5],12,1200080426),e=W(e,f,c,d,a[g+6],17,-1473231341),d=W(d,e,f,c,a[g+7],22,-45705983),c=W(c,d,e,f,a[g+8],7,1770035416),f=W(f,c,d,e,a[g+9],12,-1958414417),e=W(e,f,c,d,a[g+10],17,-42063),d=W(d,e,f,c,a[g+11],22,-1990404162),c=W(c,d,e,f,a[g+12],7,1804603682),f=W(f,c,d,e,a[g+13],12,-40341101),e=W(e,f,c,d,a[g+14],17,-1502002290),d=W(d,e,f,c,a[g+15],22,1236535329),c=X(c,d,e,f,a[g+1],5,-165796510),f=X(f,c,d,e,a[g+6],9,-1069501632),e=X(e,f,c,d,a[g+11],14,643717713),d=X(d,e,f,c,a[g+0],20,-373897302),c=X(c,d,e,f,a[g+5],5,-701558691),f=X(f,c,d,e,a[g+10],9,38016083),e=X(e,f,c,d,a[g+15],14,-660478335),d=X(d,e,f,c,a[g+4],20,-405537848),c=X(c,d,e,f,a[g+9],5,568446438),f=X(f,c,d,e,a[g+14],9,-1019803690),e=X(e,f,c,d,a[g+3],14,-187363961),d=X(d,e,f,c,a[g+8],20,1163531501),c=X(c,d,e,f,a[g+13],5,-1444681467),f=X(f,c,d,e,a[g+2],9,-51403784),e=X(e,f,c,d,a[g+7],14,1735328473),d=X(d,e,f,c,a[g+12],20,-1926607734),c=Y(c,d,e,f,a[g+5],4,-378558),f=Y(f,c,d,e,a[g+8],11,-2022574463),e=Y(e,f,c,d,a[g+11],16,1839030562),d=Y(d,e,f,c,a[g+14],23,-35309556),c=Y(c,d,e,f,a[g+1],4,-1530992060),f=Y(f,c,d,e,a[g+4],11,1272893353),e=Y(e,f,c,d,a[g+7],16,-155497632),d=Y(d,e,f,c,a[g+10],23,-1094730640),c=Y(c,d,e,f,a[g+13],4,681279174),f=Y(f,c,d,e,a[g+0],11,-358537222),e=Y(e,f,c,d,a[g+3],16,-722521979),d=Y(d,e,f,c,a[g+6],23,76029189),c=Y(c,d,e,f,a[g+9],4,-640364487),f=Y(f,c,d,e,a[g+12],11,-421815835),e=Y(e,f,c,d,a[g+15],16,530742520),d=Y(d,e,f,c,a[g+2],23,-995338651),c=Z(c,d,e,f,a[g+0],6,-198630844),f=Z(f,c,d,e,a[g+7],10,1126891415),e=Z(e,f,c,d,a[g+14],15,-1416354905),d=Z(d,e,f,c,a[g+5],21,-57434055),c=Z(c,d,e,f,a[g+12],6,1700485571),f=Z(f,c,d,e,a[g+3],10,-1894986606),e=Z(e,f,c,d,a[g+10],15,-1051523),d=Z(d,e,f,c,a[g+1],21,-2054922799),c=Z(c,d,e,f,a[g+8],6,1873313359),f=Z(f,c,d,e,a[g+15],10,-30611744),e=Z(e,f,c,d,a[g+6],15,-1560198380),d=Z(d,e,f,c,a[g+13],21,1309151649),c=Z(c,d,e,f,a[g+4],6,-145523070),f=Z(f,c,d,e,a[g+11],10,-1120210379),e=Z(e,f,c,d,a[g+2],15,718787259),d=Z(d,e,f,c,a[g+9],21,-343485551),c=ab(c,h),d=ab(d,i),e=ab(e,j),f=ab(f,k)}return Array(c,d,e,f)}function V(a,b,c,d,e,f){return ab(bb(ab(ab(b,a),ab(d,f)),e),c)}function W(a,b,c,d,e,f,g){return V(b&c|~b&d,a,b,e,f,g)}function X(a,b,c,d,e,f,g){return V(b&d|c&~d,a,b,e,f,g)}function Y(a,b,c,d,e,f,g){return V(b^c^d,a,b,e,f,g)}function Z(a,b,c,d,e,f,g){return V(c^(b|~d),a,b,e,f,g)}function ab(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function bb(a,b){return a<<b|a>>>32-b}function cb(a){for(var b=Array(),c=(1<<v)-1,d=0;a.length*v>d;d+=v)b[d>>5]|=(a.charCodeAt(d/v)&c)<<d%32;return b}function eb(a){for(var b=t?"0123456789ABCDEF":"0123456789abcdef",c="",d=0;4*a.length>d;d++)c+=b.charAt(15&a[d>>2]>>8*(d%4)+4)+b.charAt(15&a[d>>2]>>8*(d%4));return c}var d,e,n,s,b=$=a("gallery/jquery/1.0.0/jquery"),i=(a("common/utils/1.0.0/utils"),0),j=0,k={action:"",domain:"xunlei.com",form:"loginform",box:"login_box",u:"login_u",p:"login_p",auto:"login_auto",verifycode:"login_verifycode",verifyimg:"login_verify_code",verifyref:"login_ref_verify",verifyp:"login_vcode_p",tip:"login_tip",submit:"login_submit",expire:720},l={oriType:0,type:"vodVipUser",level:-1,expire:"",last_expire:"",flux:-1},m={sidExpired:"登录出现异常，请重新登录"},o=["http://login.xunlei.com/","http://login2.xunlei.com/","http://login3.xunlei.com/"],q="/domain.html",r=0,t=0,v=8;b.extend(String.prototype,{trim:function(){return this.replace(/(^\s+)|(\s+$)/g,"")}}),b.fn.extend({loginshowInputTips:function(a){this._tips=a,""==this.val().trim()&&(this.val(a),this.css("color","gray")),this.focus($.proxy(function(){this.val().trim()==this._tips&&(this.css("color","black"),this.val(""))},this)),this.blur($.proxy(function(){""==this.val().trim()&&(this.css("color","gray"),this.val(this._tips))},this))}}),Function.prototype.delayApply=function(a,b,c){var d=this;return setTimeout(function(){d.apply(b,c)},a)};var y=function(){};y.prototype.addEventListener=function(a,b,c){var d=this;if(this[a]||(this[a]=[]),!(this[a]instanceof Array))return!1;for(var e=0;this[a].length>e;e++)if(this[a][e].o==d&&this[a][e].f==b)return!0;return this[a].push({o:d,f:b,t:c}),this},y.prototype.attachEvent=y.prototype.addEventListener,y.prototype.removeEventListener=function(a,b){var c=this;if(!(this[a]&&this[a]instanceof Array))return!1;if(!b)return this[a]=[],!0;for(var d=0;this[a].length>d;d++)if(this[a][d].o==c&&this[a][d].f==b)return this[a].splice(d,1),0==this[a].length&&delete this[a],!0;return!1},y.prototype.detachEvent=y.prototype.removeEventListener,y.prototype.dispatchEvent=function(a){if(!(this[a]&&this[a]instanceof Array))return!1;var b=[this].concat(z(arguments));b.shift(),b.shift();for(var c=this[a].slice(0),d=0;c.length>d;d++)"number"==typeof c[d].t?c[d].f.delayApply(c[d].t,c[d].o,b):c[d].f.apply(c[d].o,b);return!0},y.prototype.fireEvent=y.prototype.dispatchEvent;var A=null,D={init:function(a){var c=this;d=null,e=null,b.extend(k,a),o=["http://login."+k.domain+"/","http://login2."+k.domain+"/","http://login3."+k.domain+"/"],A=A||new y,b.extend(c,A);var f=new String("onsuccess,onerror,onvalid,onlogining,onautoerror,onlogout,onuserinfoloaded").split(",");for(var g in a)","!=g&&-1!=b.inArray(g,f)&&(this.removeEventListener(g),this[g.substr(2)](a[g]));$(window).load(function(){});var h=function(){var a=$("#"+k.u).val();a=$.trim(a),a&&H(a)};setTimeout(h,20),$("#"+k.u).change(function(){setTimeout(h,50)}).focus(function(){i=1}).blur(function(){i=0,h()}),$("#"+k.p).focus(function(){i=1}).blur(function(){i=0}),$("#"+k.verifyref).click(function(){c.vcode()}),$("#"+k.verifycode).focus(function(){$(this).val(""),i=1}).blur(function(){$(this).val()||$(this).val("验证码"),i=0}),$("#"+k.auto).click(function(){this.focus()}).focus(function(){i=1}).blur(function(){i=0}),$("#"+k.box).keydown(function(a){return 0==i?!0:13!=a.keyCode?!0:"none"==$("#"+k.box).css("display")?!0:(c.run(),void 0)}),$("#"+k.submit).click(function(){c.run()}),$("#"+k.submit).attr("disable",!1);var j=$.trim(w("lx_login_u")),l=$.trim(w("luserid")),n=$.trim(w("lsessionid"));return""!=l&&""!=n||$("#"+k.u).val(j).change(),"sidExpired"==k.action&&(this.showTip(m.sidExpired),this.exit()),this},resetLogBox:function(){var a=$("#"+k.u),b=$("#"+k.p),c=$("#"+k.auto),d=$("#"+k.verifyp),e=$("#"+k.tip);a.val(""),b.val(""),c.attr("checked",!0),d.hide(),e.text("").hide()},showTip:function(a){var b=$("#"+k.tip);b.text(a).show()},vcode:function(){$("#"+k.verifyp),$("#"+k.verifyimg).attr("src","http://verify."+k.domain+"/image?cachetime="+(new Date).getTime()),$("#"+k.verifyp),$("#"+k.verifycode).val("")},vOneCode:function(){var a=$("#"+k.verifyimg),b=$("#"+k.verifyp);""==a.attr("src")||void 0==a.attr("src")?a.attr("src","http://verify."+k.domain+"/image?cachetime="+(new Date).getTime()):this.vcode(),a.show(),b.show(),$("#"+k.verifycode).val("验证码")},run:function(){if(1!=j){if(!I())return"";$("#"+k.submit).attr("disable",!0);var a="poster_iframe_"+(new Date).getTime()+"_"+parseInt(1e5*Math.random());return $("body").append("<iframe id='"+a+"' name='"+a+"' src='"+q+"' width='0' height='0'></iframe>"),d=$("#"+a),d.load(J),d.hide(),this}},exit:function(){for(var a=["sessionid","usrname","nickname","userid","usertype","usernewno","raw","isvip","blogresult","vipstate","p_t","lsessionid","luserid"],b=0;a.length>b;b++)x(a[b],"",0,1),C(a[b],"",0,1);return this.logout(),this},auto:function(a){var b=this;if(n=a?a:w("lsessionid"),w("sessionid")&&w("userid"))return b.success(1),this;if(!n)return b.autoerror(),this;var c="poster_iframe_"+(new Date).getTime()+"_"+parseInt(1e5*Math.random());return $("body").append("<iframe id='"+c+"' name='"+c+"' src='"+q+"' width='0' height='0'></iframe>"),d=$("#"+c),d.load(L),d.hide(),this},success:function(){var a=[this,"onsuccess"].concat(z(arguments));return F.apply(this,a),"function"!=typeof arguments[0]?this:void 0},error:function(){var a=[this,"onerror"].concat(z(arguments));return F.apply(this,a),this},valid:function(){var a=[this,"onvalid"].concat(z(arguments));return F.apply(this,a),this},autoerror:function(){var a=[this,"onautoerror"].concat(z(arguments));return F.apply(this,a),this},logout:function(){var a=[this,"onlogout"].concat(z(arguments));return F.apply(this,a),this},logining:function(){var a=[this,"onlogining"].concat(z(arguments));return F.apply(this,a),this},userinfoloaded:function(){var a=[this,"onuserinfoloaded"].concat(z(arguments));return F.apply(this,a),this},unbind:function(a,b){return this.removeEventListener("on"+a,b),this},getuserinfo:function(){return l}},G=!1;return D});